{
  "project": "Raise Exceptions by Default",
  "description": "Replace the { data:, error: } hash return pattern across all gems with idiomatic Ruby exception raising. Methods return data directly on success and raise typed exceptions on failure. This is a breaking change affecting all gems in the SDK.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Unified Error Base Class",
      "description": "As a gem maintainer, I want a unified Supabase::Error base class so that all gems share a consistent exception foundation.",
      "acceptanceCriteria": [
        "Create Supabase::Error \u003c StandardError with context: attribute in the core supabase gem",
        "Add Supabase::ApiError \u003c Supabase::Error with status: attribute for HTTP-level errors",
        "Add Supabase::NetworkError \u003c Supabase::Error for connection/timeout failures (wraps Faraday errors)",
        "All existing gem-specific error classes inherit from the appropriate base (Supabase::Error, Supabase::ApiError, or Supabase::NetworkError)",
        "Existing error attributes are preserved (code, details, hint, reasons, etc.)",
        "All error classes pass rubocop checks",
        "Unit tests cover instantiation and attribute accessors for all error classes"
      ],
      "priority": 1,
      "passes": true,
      "inProgress": false
    },
    {
      "id": "US-002",
      "title": "Auth Client - Raise Exceptions",
      "description": "As a developer using the Auth client, I want methods to return data directly and raise exceptions on failure so that I can use standard Ruby error handling.",
      "acceptanceCriteria": [
        "AuthError inherits from Supabase::Error",
        "AuthApiError inherits from Supabase::ApiError",
        "AuthRetryableFetchError inherits from Supabase::NetworkError",
        "All Auth client methods return data directly on success (not { data:, error: })",
        "All Auth client methods raise the appropriate exception on failure",
        "HttpHandler raises instead of returning error hashes",
        "ErrorClassifier raises classified errors instead of returning them",
        "Remove all \"return result if result[:error]\" early-return propagation in sign_in_methods.rb, sign_up_methods.rb, session_methods.rb, user_methods.rb, verify_methods.rb (exceptions propagate naturally)",
        "mfa_api.rb and mfa_methods.rb return data directly and raise on failure (remove all { data:, error: } returns and result[:error] checks)",
        "All existing auth specs are updated to use raise_error matchers",
        "All auth specs pass"
      ],
      "priority": 2,
      "passes": true,
      "inProgress": false
    },
    {
      "id": "US-003",
      "title": "Storage Client - Raise Exceptions",
      "description": "As a developer using the Storage client, I want methods to return data directly and raise exceptions on failure.",
      "acceptanceCriteria": [
        "StorageError inherits from Supabase::Error",
        "StorageApiError inherits from Supabase::ApiError",
        "StorageUnknownError inherits from Supabase::NetworkError",
        "All Storage client methods (get_bucket, list_buckets, upload, download, etc.) return data directly",
        "handle_response raises on non-2xx instead of returning error hash",
        "Faraday rescue blocks raise StorageUnknownError instead of returning hash",
        "Remove the unknown_error_result helper method and all its call sites in bucket_api.rb, file_operations.rb, url_operations.rb, and storage_file_api.rb (replace with direct raise StorageUnknownError)",
        "All existing storage specs updated and passing"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "US-004",
      "title": "PostgREST Client - Raise Exceptions and Response Object",
      "description": "As a developer using the PostgREST client, I want execute to return a response object with data, count, status, and status_text on success and raise exceptions on failure.",
      "acceptanceCriteria": [
        "PostgrestError inherits from Supabase::ApiError (keeps details, hint, code attributes)",
        "Create Supabase::PostgREST::Response value object with data, count, status, status_text accessors",
        "execute returns a Response object on success",
        "execute raises PostgrestError on HTTP errors",
        "Network failures raise PostgrestError with code \"FETCH_ERROR\"",
        "Remove throw_on_error method from the builder (raising is now the only behavior)",
        "Remove @throw_on_error flag and all conditional raise/return logic",
        "Update single() and maybeSingle() in filter_builder.rb to work with Response objects instead of error-hash merging (result.merge(data: nil, error: error))",
        "All existing postgrest specs updated and passing"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "US-005",
      "title": "Functions Client - Raise Exceptions",
      "description": "As a developer using the Functions client, I want invoke to return data directly and raise exceptions on failure.",
      "acceptanceCriteria": [
        "FunctionsError inherits from Supabase::Error",
        "FunctionsHttpError inherits from Supabase::ApiError",
        "FunctionsRelayError inherits from Supabase::ApiError",
        "FunctionsFetchError inherits from Supabase::NetworkError",
        "invoke returns parsed response data directly on success",
        "invoke raises FunctionsRelayError when x-relay-error header is present",
        "invoke raises FunctionsHttpError on non-2xx responses",
        "invoke raises FunctionsFetchError on network failures",
        "All existing functions specs updated and passing"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "US-006",
      "title": "Main Supabase Client - Update Integration",
      "description": "As a developer using the main Supabase::Client, I want all sub-clients to behave consistently with the new exception-based pattern.",
      "acceptanceCriteria": [
        "Main client initialization and sub-client wiring works with updated gems",
        "No hash unwrapping or error-checking code remains in the main client",
        "Integration-level specs (if any) are updated and passing",
        "bundle exec rake spec passes across all gems from the root"
      ],
      "priority": 3,
      "passes": false
    },
    {
      "id": "US-007",
      "title": "Update All Tests",
      "description": "As a gem maintainer, I want all test suites to validate the new exception-based behavior and ensure no regressions.",
      "acceptanceCriteria": [
        "All expect(result[:error]) patterns replaced with expect { ... }.to raise_error(ErrorClass)",
        "All expect(result[:data]) patterns replaced with direct return value assertions",
        "PostgREST tests assert on Response object attributes",
        "Error attribute assertions (status, code, message, context) preserved in raise_error blocks",
        "bundle exec rake spec passes with zero failures from the root directory",
        "bundle exec rubocop passes with zero offenses"
      ],
      "priority": 3,
      "passes": false
    }
  ]
}
